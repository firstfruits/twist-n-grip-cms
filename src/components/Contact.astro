---
interface Props {
  title?: string;
  description?: string;
}

const {
  title = "Get in Touch",
  description = "We'd love to hear from you. Send us a message below.",
} = Astro.props;
---

<section class="py-16 bg-gray-50" id="contact">
  <div class="max-w-[800px] mx-auto px-4 md:px-8">
    <div class="text-center mb-10">
      <h2 class="text-3xl font-bold text-[#1a202c] mb-3">{title}</h2>
      <p class="text-gray-500 text-sm font-medium">
        {description}
      </p>
    </div>

    <form
      class="bg-white rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] p-8 md:p-10 border border-gray-100"
      name="contact"
      method="POST"
      data-netlify="true"
    >
      <input type="hidden" name="form-name" value="contact" />

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div class="flex flex-col gap-2">
          <label for="name" class="text-sm font-semibold text-gray-700"
            >Name</label
          >
          <input
            type="text"
            id="name"
            name="name"
            placeholder="Your name"
            required
            class="w-full px-4 py-3 rounded-lg bg-gray-50 border border-gray-200 text-[#1a202c] placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#C83B2A]/20 focus:border-[#C83B2A] transition-all duration-200"
          />
        </div>

        <div class="flex flex-col gap-2">
          <label for="phone" class="text-sm font-semibold text-gray-700"
            >Phone</label
          >
          <input
            type="tel"
            id="phone"
            name="phone"
            placeholder="Your phone number"
            class="w-full px-4 py-3 rounded-lg bg-gray-50 border border-gray-200 text-[#1a202c] placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#C83B2A]/20 focus:border-[#C83B2A] transition-all duration-200"
          />
        </div>
      </div>

      <div class="flex flex-col gap-2 mb-6">
        <label for="email" class="text-sm font-semibold text-gray-700"
          >Email</label
        >
        <input
          type="email"
          id="email"
          name="email"
          placeholder="your.email@example.com"
          required
          class="w-full px-4 py-3 rounded-lg bg-gray-50 border border-gray-200 text-[#1a202c] placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#C83B2A]/20 focus:border-[#C83B2A] transition-all duration-200"
        />
      </div>

      <div class="flex flex-col gap-2 mb-8">
        <label for="message" class="text-sm font-semibold text-gray-700"
          >Message</label
        >
        <textarea
          id="message"
          name="message"
          rows="4"
          placeholder="How can we help you?"
          required
          class="w-full px-4 py-3 rounded-lg bg-gray-50 border border-gray-200 text-[#1a202c] placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#C83B2A]/20 focus:border-[#C83B2A] transition-all duration-200 resize-none"
        ></textarea>
      </div>

      <button
        type="submit"
        class="w-full bg-[#C83B2A] hover:bg-[#b03425] text-white font-bold py-3.5 rounded-lg transition-colors duration-200 shadow-sm"
      >
        Send Message
      </button>
    </form>
  </div>

  <!-- Toast Notification -->
  <div
    id="toast"
    class="fixed bottom-5 right-5 z-50 transform translate-y-20 opacity-0 transition-all duration-300 ease-in-out"
  >
    <div
      class="flex items-center gap-3 px-6 py-4 rounded-lg shadow-lg border-l-4 bg-white"
      id="toast-content"
    >
      <div id="toast-icon">
        <!-- Icons injected via JS -->
      </div>
      <div>
        <h4 class="font-bold text-sm" id="toast-title">Notification</h4>
        <p class="text-xs text-gray-500" id="toast-message">Message body</p>
      </div>
      <button
        class="ml-4 text-gray-400 hover:text-gray-600 transition-colors"
        id="toast-close"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-4 w-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>
</section>

<script>
  const form = document.querySelector(
    'form[name="contact"]',
  ) as HTMLFormElement;
  const toast = document.getElementById("toast");
  const toastContent = document.getElementById("toast-content");
  const toastTitle = document.getElementById("toast-title");
  const toastMessage = document.getElementById("toast-message");
  const toastIcon = document.getElementById("toast-icon");
  const toastClose = document.getElementById("toast-close");

  const showToast = (
    type: "success" | "error",
    title: string,
    message: string,
  ) => {
    if (!toast || !toastContent || !toastTitle || !toastMessage || !toastIcon)
      return;

    // Reset classes
    toastContent.className =
      "flex items-center gap-3 px-6 py-4 rounded-lg shadow-lg border-l-4 bg-white min-w-[300px]";

    if (type === "success") {
      toastContent.classList.add("border-green-500");
      toastIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
    } else {
      toastContent.classList.add("border-red-500");
      toastIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
    }

    toastTitle.textContent = title;
    toastMessage.textContent = message;

    // Show toast
    toast.classList.remove("translate-y-20", "opacity-0");

    // Auto hide after 5 seconds
    setTimeout(() => {
      hideToast();
    }, 5000);
  };

  const hideToast = () => {
    if (!toast) return;
    toast.classList.add("translate-y-20", "opacity-0");
  };

  toastClose?.addEventListener("click", hideToast);

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const data = new URLSearchParams(formData as any).toString();

    try {
      const response = await fetch("/", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: data,
      });

      if (response.ok) {
        showToast("success", "Message Sent!", "We'll get back to you shortly.");
        form.reset();
      } else {
        throw new Error("Form submission failed");
      }
    } catch (error) {
      showToast("error", "Error", "Something went wrong. Please try again.");
    }
  });
</script>
